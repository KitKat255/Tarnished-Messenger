See the `update-testing` fork for the cleaner version of the code with minor QoL fixes.
